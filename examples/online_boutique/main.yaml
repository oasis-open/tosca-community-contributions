tosca_definitions_version: tosca_2_0

imports:
  - profile: community.tosca.application:0.1
    namespace: app

description: >-
  Online Boutique service template

service_template:
  node_templates:
    frontend:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: frontend
      capabilities:
        endpoint:
          properties:
            port: 80
            target-port: 8080
            name: http
      requirements:
        - endpoint: ad
        - endpoint: recommend
        - endpoint: catalog
        - endpoint: cart
        - endpoint: shipping
        - endpoint: currency
        - endpoint: checkout
    checkout:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: checkout
      capabilities:
        endpoint:
          properties:
            port: 5050
            target-port: 5050
            name: grpc
      requirements:
        - endpoint: catalog
        - endpoint: cart
        - endpoint: shipping
        - endpoint: currency
        - endpoint: payment
        - endpoint: email
    ad:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: ad
      capabilities:
        endpoint:
          properties:
            port: 9555
            target-port: 9555
            name: grpc
    recommend:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: recommendation
      capabilities:
        endpoint:
          properties:
            port: 8080
            target-port: 8080
            name: grpc
      requirements:
        - endpoint: catalog
    cart:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: cart
      capabilities:
        endpoint:
          properties:
            port: 7070
            target-port: 7070
            name: grpc
      requirements:
        - endpoint: redis
    catalog:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: product_catalog
      capabilities:
        endpoint:
          properties:
            port: 3550
            target-port: 3550
            name: grpc
    shipping:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: shipping
      capabilities:
        endpoint:
          properties:
            port: 50051
            target-port: 50051
            name: grpc
    currency:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: currency
      capabilities:
        endpoint:
          properties:
            port: 7000
            target-port: 7000
            name: grpc
    payment:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: payment
      capabilities:
        endpoint:
          properties:
            port: 50051
            target-port: 50051
            name: grpc
    email:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: email
      capabilities:
        endpoint:
          properties:
            port: 5000
            target-port: 8080
            name: grpc
    redis:
      type: app:MicroService
      directives: [substitute]
      properties:
        name: redis
      capabilities:
        endpoint:
          properties:
            port: 6379
            target-port: 6379
            name: tcp-redis

