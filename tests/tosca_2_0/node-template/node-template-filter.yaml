tosca_definitions_version: tosca_2_0
# PJ 2025-12-22 Ubicity doesn't seem to impement node filter condition
relationship_types:
  HostedOn: {}
interface_types:
  control:
    operations:
      configure:
        inputs:
          script:
            type: string
            description: The script to run
artifact_types:
  shell_script:
    file_ext: [sh]
capability_types:
  compute:
    properties:
      class:
        type: string
        required: false
  db-server:
    properties:
      type:
        type: string
        required: false
node_types:
  DBMS.MySQL:
    properties:
      root-password:
        type: string
        description: The password for the root user
      port:
        type: integer
        description: The port number for the MySQL server
    attributes:
      db_size:
        type: string
        description: The size of the database
    interfaces:
      standard:
        type: control
        operations:
          configure:
            inputs:
              script:
                type: string
                default: scripts/configure_mysql.sh
    requirements:
      - host:
          capability: db-server
          relationship: HostedOn
  db-server:
    properties:
      num_cpus:
        type: integer
        description: Number of CPUs
    capabilities:
      host:
        type: db-server
service_template:
  inputs:
    my-mysql-rootpw:
      type: string
    my-mysql-port:
      type: integer
  node_templates:
    mysql:
      type: DBMS.MySQL
      description: MySQL Database Management System
      metadata:
        template_name: mysql_database
        template_version: 1.0.0
      properties:
        root-password: { $get_input: my-mysql-rootpw }
        port: { $get_input: my-mysql-port }
      attributes:
        db_size: 20GB
      requirements:
      - host: db-server
      interfaces:
        standard:
          operations:
            configure:
      artifacts:
        install_script:
          type: shell_script
          file: scripts/install_mysql.sh
      count: 1
    node_filter:
      $in_range:
        - $get_property: [ SELF, port ]
        - [ 1024, 65535 ]

